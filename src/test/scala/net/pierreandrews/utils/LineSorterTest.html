<!DOCTYPE html><html lang="en"><head><title>src/test/scala/net/pierreandrews/utils/LineSorterTest</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../../../../"><meta name="groc-document-path" content="src/test/scala/net/pierreandrews/utils/LineSorterTest"><meta name="groc-project-path" content="src/test/scala/net/pierreandrews/utils/LineSorterTest.scala"><meta name="groc-github-url" content="https://github.com/Mortimerp9/LogSplit"><link rel="stylesheet" type="text/css" media="all" href="../../../../../../assets/style.css"><script type="text/javascript" src="../../../../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/Mortimerp9/LogSplit/blob/master/src/test/scala/net/pierreandrews/utils/LineSorterTest.scala">src/test/scala/net/pierreandrews/utils/LineSorterTest.scala</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">package</span> net.pierreandrews.utils

<span class="hljs-keyword">import</span> scala.util.<span class="hljs-type">Random</span>

<span class="hljs-keyword">import</span> org.joda.time.<span class="hljs-type">DateTime</span>
<span class="hljs-keyword">import</span> org.scalatest.{<span class="hljs-type">FunSuite</span>, <span class="hljs-type">Matchers</span>}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Test the line sorter iterator
User: pierre
Date: 11/30/14</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LineSorterTest</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">FunSuite</span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-title">Matchers</span> {</span>

  test(<span class="hljs-string">"should sort"</span>) {

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">numPerIt</span> =</span> <span class="hljs-number">100</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sortedSeq</span>(</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">Int</span>] = <span class="hljs-type">Iterator</span>.iterate(numPerIt) { prev =&gt;
      <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">dec</span> =</span> <span class="hljs-type">Random</span>.nextInt(prev)
      prev - dec
    }.take(numPerIt).toSeq

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it1</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it2</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it3</span> =</span> sortedSeq()

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">expected</span> =</span> (it1 ++ it2 ++ it3).sortBy(x =&gt; -x)

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it</span>:</span> <span class="hljs-type">Seq</span>[<span class="hljs-type">Int</span>] = <span class="hljs-keyword">new</span> <span class="hljs-type">LineSorter</span>(<span class="hljs-type">Seq</span>(it1.iterator, it2.iterator, it3.iterator), (x: <span class="hljs-type">Int</span>) =&gt; <span class="hljs-type">Some</span>(x)).toSeq

    it.toSeq should equal(expected)

  }

  test(<span class="hljs-string">"should sort dates"</span>) {
    <span class="hljs-keyword">import</span> net.pierreandrews.<span class="hljs-type">SorterActor</span>.<span class="hljs-type">JodaDateTimeOrdering</span>

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">numPerIt</span> =</span> <span class="hljs-number">5</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sortedSeq</span>(</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">DateTime</span>] = <span class="hljs-type">Iterator</span>.iterate(<span class="hljs-type">System</span>.currentTimeMillis) { previousTS =&gt;
      <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">dec</span> =</span> <span class="hljs-type">Random</span>.nextInt(<span class="hljs-number">3600</span>) * <span class="hljs-number">1000</span>L
      previousTS - dec
    }.map { ts =&gt;
      <span class="hljs-keyword">new</span> <span class="hljs-type">DateTime</span>(ts)
    }.take(<span class="hljs-number">5</span>).toSeq

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it1</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it2</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it3</span> =</span> sortedSeq()

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">expected</span> =</span> (it1 ++ it2 ++ it3).sortBy(x =&gt; x).reverse
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it</span>:</span> <span class="hljs-type">Seq</span>[<span class="hljs-type">DateTime</span>] = <span class="hljs-keyword">new</span> <span class="hljs-type">LineSorter</span>(<span class="hljs-type">Seq</span>(it1.iterator, it2.iterator, it3.iterator), (x: <span class="hljs-type">DateTime</span>) =&gt; <span class="hljs-type">Some</span>(x)).toSeq

    it.toSeq should equal(expected)

  }

  test(<span class="hljs-string">"should sort with illegal lines"</span>) {

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">numPerIt</span> =</span> <span class="hljs-number">100</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sortedSeq</span>(</span>): <span class="hljs-type">Seq</span>[<span class="hljs-type">Int</span>] = <span class="hljs-type">Iterator</span>.iterate(numPerIt) { prev =&gt;
      <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">dec</span> =</span> <span class="hljs-type">Random</span>.nextInt(prev)
      prev - dec
    }.take(numPerIt).toSeq

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it1</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it2</span> =</span> sortedSeq()
    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it3</span> =</span> sortedSeq()

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">expected</span> =</span> (it1 ++ it2 ++ it3).filter(_%<span class="hljs-number">4</span>!=<span class="hljs-number">0</span>).sortBy(x =&gt; -x)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sortWithFail</span>(</span>x: <span class="hljs-type">Int</span>) = {
      <span class="hljs-keyword">if</span>(x % <span class="hljs-number">4</span> == <span class="hljs-number">0</span>) <span class="hljs-type">None</span>
      <span class="hljs-keyword">else</span> <span class="hljs-type">Some</span>(x)
    }

    <span class="hljs-function"><span class="hljs-keyword">val</span> <span class="hljs-title">it</span>:</span> <span class="hljs-type">Seq</span>[<span class="hljs-type">Int</span>] = <span class="hljs-keyword">new</span> <span class="hljs-type">LineSorter</span>(<span class="hljs-type">Seq</span>(it1.iterator, it2.iterator, it3.iterator), sortWithFail).toSeq

    it.toSeq should equal(expected)
  }

}</div></div></div></div></body></html>